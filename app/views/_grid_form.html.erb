<%- 
model_name = grid.model.name.underscore
columns = grid.columns.dup.delete_if {|x| x.name.to_s == 'id' }
datepicker_str = ''
%>
<div id="<%= grid.name %>-form" title="Create new <%= model_name.titleize %>" class="create_form">
  <form accept-charset="UTF-8" action="/<%= model_name.tableize %>" class="<%= model_name %>" id="new_<%= grid.name %>" method="post">
    <div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div> 
    <%- columns.each do |column| %>
      <%- column_name = column.form_name %>
      <%- datepicker_str << %!$('##{model_name}_#{column_name}').datepicker({ dateFormat: 'yy-mm-dd' });! if column.sql_type.to_s.downcase == 'datetime'  %>
      <div class="field" name="<%= column_name %>">
        <label for="<%= model_name %>_<%= column_name %>"><%= column.label %></label>
        <%- if column.sql_type.to_s == 'belongs_to' %>
          <%= select_tag "#{model_name}[#{column_name}]", 
          options_from_collection_for_select(column.choices, "id", column.option_text_attribute), 
          {:include_blank => !column.presence_required?, :class => 'chzn-select', :style => "width:250px"} %>
          
        <%- elsif column.sql_type.to_s == 'has_and_belongs_to_many' %>
          <%= select_tag "#{model_name}[#{column.reflection.name.to_s}]", 
          options_from_collection_for_select(column.choices, "id", column.option_text_attribute), 
          {:include_blank => !column.presence_required?, :multiple => true, :class => 'chzn-select', :style => "width:250px"} %>
          
        <%- elsif column.options[:choices].present? %>
          <%= select_tag "#{model_name}[#{column_name}]", raw(column.options[:choices].inject(''){|options, x| options << "<option value='#{x[:id]}'>#{x[:name]}</option>"}), 
          {:class => 'chzn-select', :style => "width:250px"} %>
          
        <%- else %>
          <%- if column.sql_type.to_s == 'boolean' %>
            <input type="checkbox" id="<%= model_name %>_<%= column_name %>" name="<%= model_name %>[<%= column_name %>]" value="1" />
          <% else %>
            <input id="<%= model_name %>_<%= column_name %>" name="<%= model_name %>[<%= column_name %>]" type="text" style="width:250px" />
          <% end -%>
        <%- end %>
        <div class="field_error"></div>
      </div>
    <% end -%>
    <div class="submit"> 
      <input id="<%= grid.name %>_submit" name="commit" type="submit" value=" Create " /> 
      <input id="<%= grid.name %>_submit_continue" name="commit" type="submit" value=" Create and Continue " /> 
    </div>
  </form>
</div>

<%= javascript_tag do -%>
  $(".chzn-select").chosen();
  <%= datepicker_str -%>
<% end -%>